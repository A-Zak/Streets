<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>A story about love and darkness</title>

    <link href="/public/css/bootstrap.min.css" rel="stylesheet">
    	<script type="text/javascript" src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
   	<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=false&amp;libraries=places"></script>
	<script type="text/javascript" src="/public/js/bootstrap-tagsinput.min.js"></script>
	<script type="text/javascript" src="/public/js/jquery.geocomplete.js"></script>

	
	
    <!-- Bootstrap Core JavaScript -->
    <script src="/public/js/bootstrap.min.js"></script>

    <!-- Custom Theme JavaScript -->
    
    <!-- Custom CSS -->
    <link href="/public/css/clean-blog.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

	<script type="text/javascript">
			var geocoder;
			function initialize() {
		  		geocoder = new google.maps.Geocoder();
			}
			
			function codeAddress(address, callback) {
			  geocoder.geocode( { 'address': address}, function(results, status) {
			    if (status == google.maps.GeocoderStatus.OK) {
			      callback(results[0].geometry.location);
			    } else {
			      alert('Geocode was not successful for the following reason: ' + status);
			    }
			  });
			}
			
			google.maps.event.addDomListener(window, 'load', initialize);
			
			$(document).ready(function($) {
				var geocode_callback = function(coords) {
						var url = 'url(http://maps.googleapis.com/maps/api/streetview?size=640x640&location='+ coords.lat() + ',' + coords.lng()+'&fov=90&heading=235&pitch=10)';
						$('#img_header').fadeOut(function() {
							$('#img_header').css('background-image',url);
							$('#txt_geocode_address').css('color','white');
							$('#txt_author_name').css('color','white');
							$("#black-overlay").addClass('black-overlay');
							$('#img_header').fadeIn();
							$('#your_story_container').fadeIn();
							$('#btn-upload-photo').show();
							$('#btn_inspire').fadeOut();
						});
						
				}
				
				var bind_autocomplete_function = function(event, result){
					codeAddress(result.formatted_address,geocode_callback);
					var new_elem = $('#txt_geocode_address').clone()
					new_elem.val(result.address_components[1].long_name.replace('St','') + " " + result.address_components[0].long_name);
					$('#txt_geocode_address').replaceWith(new_elem);
					new_elem.geocomplete().bind("geocode:result", bind_autocomplete_function);
					
				}
				
				$("#txt_geocode_address").geocomplete().bind("geocode:result", bind_autocomplete_function);
				$('#stam_button').click(function() {
					var address = $("#txt_geocode_address").val();
					codeAddress(address,geocode_callback);
				});
				
				
				//Setting the date field:
				
				var m_names = new Array("January", "February", "March", 
							"April", "May", "June", "July", "August", "September", 
							"October", "November", "December");
							
				var date = new Date(); 
				$('#actual_date_field').html(m_names[date.getMonth()] +" " + date.getDate()+ ", " + date.getFullYear());
				
				//Setting the text clickable your story button:
				
				$('#lbl_your_story').click(function() {
					var final_width = $('#lbl_your_story').width();
					$('#your_story_container').animate({width:final_width},1000,'swing',function() {
						$(this).remove();
						$('#text_area_container').show();
						setTimeout(function() {$('#txt_your_story').focus()},1);
					});
				});
				
				
				var publish_function = function() {
					var json = {
						location:$('#txt_geocode_address').val(),
						text: $('#txt_your_story').html(),
						imageUrl:$('#img_header').css('background-image').replace('url(','').replace(')',''),
						authorName:$('#txt_your_name').html(),
					};
					
					console.log(json);
					
					$.post('/api/story',json)
					.done(function() {
						$('#btn_publish').fadeOut(function() {
							$('#share_buttons_containers').fadeIn();
						});
						
					})
					.fail(function() {
						alert("Failure");
					});
				}
				
				
				$('#btn_publish').click(function() {
				
					$(this).css('background-color','#3cb878');
					$(this).html("Are you sure?");
					$(this).click(publish_function);
					
				});
				
				
				//Handling the publish button:
				
				
				var CHARS_MAKES_PUBLISH_APPEAR = 50;
				$('#txt_your_story').keyup(function(){
					var cur_len = $(this).html().length;
					var btn_publish = $('#btn_publish');
					console.log(cur_len);
					if ( cur_len >= CHARS_MAKES_PUBLISH_APPEAR && !btn_publish.is(":visible")  ) {
						btn_publish.fadeIn();	
					}
					
				});
				
				
				//Upload photo:
				
				$('#btn-upload-photo').click(function() {
					$('#btn_upload').click();
				});
				
			     $("input:file").change(function (){
			     	$("#frm_fileupload").submit();
			     });
			});

	</script>
	
	
<style type="text/css"> 
    @import url(http://fonts.googleapis.com/earlyaccess/opensanshebrew.css);
    
    html body {
    	background-color: #EEEEEE;
    }
    
    html, body, input, span, div{
    	font-family: 'Open Sans Hebrew', serif;
    }
    
    
    
    .pac-icon {
    	background-image: none;
    }
    
    .site-heading input, .subheading{
    	color:black;
    }
    
    h1 {
    	font-size:50px;
    }
    
    .editable-title{
    	background-color: rgba(1,1,1,0); 
    	border:0px solid red; 
    }
    
    .black-overlay{ 
    	background-color:rgba(0,0,0,0.4);
    }
    
    .date-field{
    	background-color:white;
    	text-align:center;
    	padding:1em;
    }
    
    #btn_upload_photo_container{
    	text-align:center;
    	padding-bottom:2em;
    }
    
    #lbl_your_story{
    	color: #D119ff;
    }
    
    .btn-upload-photo {
    	background-color: rgba(0,0,0,0.5);
    	border:2px solid white;
    	display:none;
    }
    
    .btn-upload-photo:hover, .btn-upload-photo:focus {
    	border:2px solid white;
    }
    #txt_your_story {
    	background-color:rgba(0,0,0,0);
    	border-width:0px;
    	line-height:1.5em;
    	
    }
    #txt_your_story:focus,input:focus,button:focus {
    	border: none;
    	outline:none;
    }
    
    #publish_button_container {
    	text-align:center;
    }
    
    #btn_publish { 
    	margin-top:3em;
    }
    </style>
</head>

<body>

    <!-- Navigation 
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display 
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
            </div>
		<!--
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="index.html">Home</a>
                    </li>
                    <li>
                        <a href="about.html">About</a>
                    </li>
                    <li>
                        <a href="post.html">Sample Post</a>
                    </li>
                    <li>
                        <a href="contact.html">Contact</a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Header -->
    <!-- Set your background image for this header on the line below. -->
    <header id="img_header" class="intro-header">
    	<div id="black-overlay">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

                    <div class="site-heading">
		                <h1><input id="txt_geocode_address" type="text" class="editable-title" value="Street name?" style="text-align:center;"/></h1>
		                <span class="subheading" id="txt_author_name">A story by <span id="txt_your_name" class='editable-title' contenteditable>your name</span></span> 
                    </div>
                  <div id="btn_upload_photo_container">		          	 
		                
		                	<button type="button" id="btn-upload-photo" class="btn btn-default btn-lg btn-upload-photo">Upload your photo</button>
		                	<iframe name="postframe" id="postframe" class="hidden" src="about:none" ></iframe>
		                	  <form action="/image" enctype="multipart/form-data" method="post" id="frm_fileupload" target="postframe">
		                		<input type="file" id="btn_upload" name="upload" style="visibility: hidden; width: 1px; height: 1px" />
		                	</form>

		                
		  </div>

             </div>
            </div>
        </div>
	      	<div class="date-field">Written on <span id="actual_date_field"></span></div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <div class="row">
        	<div class="col-md-12" style="text-align:center;">	
	        	<button type="button" id="btn_inspire" class="btn btn-default btn-lg">Inspire me</button>
        	</div>
        	
        	<div class="col-md-12">
        		<div id="your_story_container" style="text-align:center; display:none;">
	        		<span id="lbl_your_story">Your story ...</span>
	        	</div>
	        	<div id="text_area_container" style="display:none;">
	        		<div style="width:100%;" id="txt_your_story" contenteditable>Your story ...</div>
	        	</div>
	        	
	        	<div id="publish_button_container">
	        		<button type="button" id="btn_publish" class="btn btn-default btn-lg" style="display:none;">Publish your story</button>
	        	</div>
	        	
	        	<div id="share_buttons_containers" style="display:none;">
	        		Yeah! your story is live!
	        	</div>
        	</div>
	</div>       
    </div>

    <hr>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
            </div>
        </div>
    </footer>


</body>

</html>
